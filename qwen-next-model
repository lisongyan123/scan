package com.hsbc.trade.transfer.service.impl;

import com.hsbc.trade.HTTPRequestHeaderConstants;
import com.hsbc.trade.service.RestClientService;
import com.hsbc.trade.service.DuplicateSubmitPreventionService;
import com.hsbc.trade.transfer.common.AccountId;
import com.hsbc.trade.transfer.common.TransferSideCode;
import com.hsbc.trade.transfer.constant.TransferQueryParameterConstant;
import com.hsbc.trade.transfer.createtransfer.CreateTransferRequest;
import com.hsbc.trade.transfer.createtransfer.CreateTransferResponse;
import com.hsbc.trade.transfer.createtransfer.ReceiverInfo;
import com.hsbc.trade.transfer.createtransfer.TransferOrderInfo;
import com.hsbc.trade.transfer.domain.account.CustomerAccounts;
import com.hsbc.trade.transfer.domain.account.InvestmentAccount;
import com.hsbc.trade.transfer.domain.cep.PartyContactResponse;
import com.hsbc.trade.transfer.domain.cep.PartyNameResponse;
import com.hsbc.trade.transfer.domain.eligibility.RuleResponse;
import com.hsbc.trade.transfer.domain.mds.GoldPriceResponse;
import com.hsbc.trade.transfer.domain.mds.GoldPriceResponseData;
import com.hsbc.trade.transfer.domain.limit.RetrieveTransferLimitResponse;
import com.hsbc.trade.transfer.domain.limit.RetrieveTransferLimitResponseData;
import com.hsbc.trade.transfer.retrievetransferdetail.RetrieveTransferDetailResponse;
import com.hsbc.trade.transfer.retrievetransferdetail.RetrieveTransferDetailResponseData;
import com.hsbc.trade.transfer.retrievetransferlist.RetrieveTransferListResponse;
import com.hsbc.trade.transfer.retrievetransferlist.RetrieveTransferListResponseData;
import com.hsbc.trade.transfer.retrievetransferlist.TransferListItemInfo;
import com.hsbc.trade.transfer.service.AbstractRestService;
import com.hsbc.trade.transfer.service.TradeTransferService;
import com.hsbc.trade.transfer.updatetransfer.UpdateTransferRequest;
import com.hsbc.trade.transfer.updatetransfer.UpdateTransferResponse;
import com.hsbc.trade.transfer.utils.ResponseInfoHandler;
import com.hsbc.trade.utils.E2ETrustTokenUtil;
import jakarta.ws.rs.BadRequestException;
import jakarta.ws.rs.InternalServerErrorException;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.extension.ExtendWith;
import org.mockito.*;
import org.mockito.junit.jupiter.MockitoExtension;
import org.springframework.test.util.ReflectionTestUtils;

import java.math.BigDecimal;
import java.net.URI;
import java.util.*;

import static com.hsbc.trade.transfer.enums.ExceptionMessageEnum.ACCOUNT_LIST_EMPTY_ERROR;
import static org.assertj.core.api.Assertions.assertThat;
import static org.junit.jupiter.api.Assertions.*;
import static org.mockito.ArgumentMatchers.*;
import static org.mockito.Mockito.*;

@ExtendWith(MockitoExtension.class)
class TradeTransferServiceImplTest {

    @Mock
    private RestClientService restClientService;

    @Mock
    private DuplicateSubmitPreventionService duplicateSubmitPreventionService;

    @Mock
    private TradeLimitServiceImpl tradeLimitService;

    @Mock
    private SreValidationServiceImpl sreValidationService;

    @Mock
    private E2ETrustTokenUtil e2ETrustTokenUtil;

    @InjectMocks
    private TradeTransferServiceImpl tradeTransferServiceImpl;

    private Map<String, String> requestHeader;

    @BeforeEach
    void setUp() {
        MockitoAnnotations.openMocks(this);

        // 初始化请求头
        requestHeader = new HashMap<>();
        requestHeader.put(HTTPRequestHeaderConstants.X_HSBC_SESSION_CORRELATION_ID, "session-123");
        requestHeader.put(HTTPRequestHeaderConstants.X_HSBC_CUSTOMER_ID, "CUST123");
        requestHeader.put(HTTPRequestHeaderConstants.X_HSBC_SRC_USERAGENT, "Mozilla/5.0");
        requestHeader.put(HTTPRequestHeaderConstants.X_HSBC_SRC_DEVICE_ID, "device-abc");
        requestHeader.put(HTTPRequestHeaderConstants.X_HSBC_LOCALE, "en-HK");

        // 手动注入所有 @Value 和私有字段（参考你的 TradeLimitServiceImplTest 风格）
        ReflectionTestUtils.setField(tradeTransferServiceImpl, "tradeOnlineUrl", "https://trade-api.hsbc.com");
        ReflectionTestUtils.setField(tradeTransferServiceImpl, "timeout", 5000);
        ReflectionTestUtils.setField(tradeTransferServiceImpl, "printMessageLog", true);

        // 注入依赖服务
        ReflectionTestUtils.setField(tradeTransferServiceImpl, "tradeLimitService", tradeLimitService);
        ReflectionTestUtils.setField(tradeTransferServiceImpl, "sreValidationService", sreValidationService);
        ReflectionTestUtils.setField(tradeTransferServiceImpl, "e2ETrustTokenUtil", e2ETrustTokenUtil);
        ReflectionTestUtils.setField(tradeTransferServiceImpl, "duplicateSubmitPreventionService", duplicateSubmitPreventionService);

        // Mock E2E token
        lenient().when(e2ETrustTokenUtil.getE2ETrustToken()).thenReturn("dummy-e2e-token");

        // Mock duplicate key
        lenient().when(duplicateSubmitPreventionService.generateUniqueKey()).thenReturn("unique-key-456");
    }

    // ========================
    // 1. 测试 retrieveTransferList
    // ========================
    @Test
    void testRetrieveTransferList_Success() {
        // Arrange
        String transferStatusCode = "PENDING";
        List<String> checksumIdentifiers = Arrays.asList("chk1", "chk2");
        String pagination = "{}";
        String productId = "GOLD";
        String sParameterType = "SENSITIVE";

        CustomerAccounts customerAccounts = new CustomerAccounts();
        InvestmentAccount acc1 = new InvestmentAccount();
        acc1.setChecksum("chk1");
        AccountId accountId1 = new AccountId();
        accountId1.setCountryAccountCode("HK");
        accountId1.setGroupMemberAccountCode("GRP1");
        accountId1.setAccountNumber("ACC123");
        accountId1.setAccountProductTypeCode("INV");
        accountId1.setAccountTypeCode("MAIN");
        accountId1.setAccountCurrencyCode("HKD");
        acc1.setInvestmentAccountId(accountId1);

        InvestmentAccount acc2 = new InvestmentAccount();
        acc2.setChecksum("chk2");
        AccountId accountId2 = new AccountId();
        accountId2.setCountryAccountCode("HK");
        accountId2.setGroupMemberAccountCode("GRP2");
        accountId2.setAccountNumber("ACC456");
        accountId2.setAccountProductTypeCode("INV");
        accountId2.setAccountTypeCode("MAIN");
        accountId2.setAccountCurrencyCode("HKD");
        acc2.setInvestmentAccountId(accountId2);

        customerAccounts.setInvestmentAccountList(Arrays.asList(acc1, acc2));

        PartyNameResponse partyNameResponse = new PartyNameResponse();
        PartyNameResponse.Name name = new PartyNameResponse.Name();
        name.setLastName("CHAN");
        name.setGivenName("ALICE");
        name.setCustomerChristianName("M");
        partyNameResponse.setName(name);

        PartyContactResponse contactResponse = new PartyContactResponse();
        PartyContactResponse.Contact contact = new PartyContactResponse.Contact();
        contact.setMobileNumber1("+85291234567");
        contactResponse.setContact(contact);

        RetrieveTransferListResponse mockResponse = new RetrieveTransferListResponse();
        RetrieveTransferListResponseData data = new RetrieveTransferListResponseData();
        TransferListItemInfo item = new TransferListItemInfo();
        item.setTransferSideCode(TransferSideCode.SENDER);
        item.setSenderCustomerFirstName("ALICE");
        item.setSenderCustomerMiddleName("M");
        item.setIsReceiverBankCustomer("Y");
        data.setTransferLists(Collections.singletonList(item));
        mockResponse.setData(data);

        // Mock 依赖
        lenient().when(restClientService.get(anyString(), anyMap(), eq(RetrieveTransferListResponse.class), anyInt(), anyBoolean()))
                .thenReturn(mockResponse);
        lenient().when(tradeTransferServiceImpl.retrieveCustomerAccounts(any())).thenReturn(customerAccounts);
        lenient().when(tradeTransferServiceImpl.retrieveCustomerNamesWithCinNumber(eq("CUST123"), any())).thenReturn(partyNameResponse);
        lenient().when(tradeTransferServiceImpl.retrieveCustomerPhoneNumberWithCinNumber(eq("CUST123"), any())).thenReturn(contactResponse);

        // Act
        RetrieveTransferListResponse result = tradeTransferServiceImpl.retrieveTransferList(
                requestHeader, transferStatusCode, checksumIdentifiers, pagination, productId, sParameterType);

        // Assert
        assertThat(result).isNotNull();
        assertThat(result.getData()).isNotNull();
        assertThat(result.getData().getTransferLists()).hasSize(1);

        // 验证响应中姓名被遮蔽
        TransferListItemInfo maskedItem = result.getData().getTransferLists().get(0);
        assertThat(maskedItem.getSenderCustomerFirstName()).isEqualTo("A****");
        assertThat(maskedItem.getSenderCustomerMiddleName()).isEqualTo("M****");

        // 验证 URI 构建参数（通过 verify）
        ArgumentCaptor<String> uriCaptor = ArgumentCaptor.forClass(String.class);
        ArgumentCaptor<Map> headersCaptor = ArgumentCaptor.forClass(Map.class);
        verify(restClientService).get(uriCaptor.capture(), headersCaptor.capture(), eq(RetrieveTransferListResponse.class), eq(5000), eq(true));

        String capturedUri = uriCaptor.getValue();
        assertThat(capturedUri).contains("transferStatusCode=PENDING");
        assertThat(capturedUri).contains("pagination={}");
        assertThat(capturedUri).contains("productId=GOLD");
        assertThat(capturedUri).contains("sParameterType=SENSITIVE");
        assertThat(capturedUri).contains("customerInternalNumber=CUST123");
        assertThat(capturedUri).contains("customerLastName=CHAN");
        assertThat(capturedUri).contains("customerFirstName=ALICE");
        assertThat(capturedUri).contains("customerChristianName=M");
        assertThat(capturedUri).contains("telephoneNumber=%2B85291234567");
        assertThat(capturedUri).contains("checksumIdentifiers=chk1%2Cchk2");

        // 验证敏感头被设置
        Map<String, String> capturedHeaders = headersCaptor.getValue();
        assertThat(capturedHeaders).containsKey("checksum-1");
        assertThat(capturedHeaders.get("checksum-1")).isEqualTo("countryAccountCode=HK;groupMemberAccountCode=GRP1;accountNumber=ACC123;accountProductTypeCode=INV;accountTypeCode=MAIN;accountCurrencyCode=HKD");
    }

    // ========================
    // 2. 测试 retrieveTransferDetail 成功
    // ========================
    @Test
    void testRetrieveTransferDetail_Success() {
        // Arrange
        String transferReferenceNumber = "REF123";

        CustomerAccounts customerAccounts = new CustomerAccounts();
        InvestmentAccount acc = new InvestmentAccount();
        acc.setChecksum("chk1");
        AccountId accountId = new AccountId();
        accountId.setAccountNumber("ACC123");
        acc.setInvestmentAccountId(accountId);
        customerAccounts.setInvestmentAccountList(Collections.singletonList(acc));

        PartyNameResponse partyNameResponse = new PartyNameResponse();
        PartyNameResponse.Name name = new PartyNameResponse.Name();
        name.setLastName("CHAN");
        name.setGivenName("ALICE");
        partyNameResponse.setName(name);

        PartyContactResponse contactResponse = new PartyContactResponse();
        PartyContactResponse.Contact contact = new PartyContactResponse.Contact();
        contact.setMobileNumber1("+85291234567");
        contactResponse.setContact(contact);

        RetrieveTransferDetailResponse mockResponse = new RetrieveTransferDetailResponse();
        RetrieveTransferDetailResponseData data = new RetrieveTransferDetailResponseData();
        data.setTransferSideCode(TransferSideCode.SENDER);
        data.setIsReceiverBankCustomer("Y");
        data.setSenderCustomerFirstName("ALICE");
        data.setSenderCustomerMiddleName("M");
        InvestmentAccount investmentAccount = new InvestmentAccount();
        investmentAccount.setAccountNumber("ACC123");
        data.setInvestmentAccount(investmentAccount);
        mockResponse.setData(data);

        // Mock
        lenient().when(restClientService.get(anyString(), anyMap(), eq(RetrieveTransferDetailResponse.class), anyInt(), anyBoolean()))
                .thenReturn(mockResponse);
        lenient().when(tradeTransferServiceImpl.retrieveCustomerAccounts(any())).thenReturn(customerAccounts);
        lenient().when(tradeTransferServiceImpl.retrieveCustomerNamesWithCinNumber(eq("CUST123"), any())).thenReturn(partyNameResponse);
        lenient().when(tradeTransferServiceImpl.retrieveCustomerPhoneNumberWithCinNumber(eq("CUST123"), any())).thenReturn(contactResponse);

        // Act
        RetrieveTransferDetailResponse result = tradeTransferServiceImpl.retrieveTransferDetail(requestHeader, transferReferenceNumber);

        // Assert
        assertThat(result).isNotNull();
        assertThat(result.getData()).isNotNull();
        assertThat(result.getData().getAccountChecksumIdentifier()).isEqualTo("chk1");
        assertThat(result.getData().getSenderCustomerFirstName()).isEqualTo("A****");
        assertThat(result.getData().getSenderCustomerMiddleName()).isEqualTo("M****");

        // 验证 checksum 替换日志
        verify(tradeTransferServiceImpl).findAccountChecksumForAccountNumber(any(), eq("ACC123"));
    }

    // ========================
    // 3. 测试 retrieveTransferDetail 失败：无账户映射
    // ========================
    @Test
    void testRetrieveTransferDetail_AccountNotFound_ThrowsBadRequestException() {
        // Arrange
        String transferReferenceNumber = "REF123";

        CustomerAccounts customerAccounts = new CustomerAccounts();
        customerAccounts.setInvestmentAccountList(Collections.emptyList()); // 空列表

        RetrieveTransferDetailResponse mockResponse = new RetrieveTransferDetailResponse();
        RetrieveTransferDetailResponseData data = new RetrieveTransferDetailResponseData();
        InvestmentAccount investmentAccount = new InvestmentAccount();
        investmentAccount.setAccountNumber("NON_EXISTENT");
        data.setInvestmentAccount(investmentAccount);
        mockResponse.setData(data);

        lenient().when(restClientService.get(anyString(), anyMap(), eq(RetrieveTransferDetailResponse.class), anyInt(), anyBoolean()))
                .thenReturn(mockResponse);
        lenient().when(tradeTransferServiceImpl.retrieveCustomerAccounts(any())).thenReturn(customerAccounts);

        // Act & Assert
        BadRequestException exception = assertThrows(BadRequestException.class, () ->
                tradeTransferServiceImpl.retrieveTransferDetail(requestHeader, transferReferenceNumber)
        );

        assertThat(exception.getMessage()).isEqualTo(ACCOUNT_LIST_EMPTY_ERROR.getCode());
    }

    // ========================
    // 4. 测试 createTransfers 成功（D 操作）
    // ========================
    @Test
    void testCreateTransfers_Success_DOperation() {
        // Arrange
        CreateTransferRequest request = new CreateTransferRequest();
        CreateTransferRequest.Data data = new CreateTransferRequest.Data();
        data.setActionRequestCode("D"); // D 操作

        ReceiverInfo receiver1 = new ReceiverInfo();
        receiver1.setReceiverCustomerNumber("CUST456");
        receiver1.setTransferQuantity(BigDecimal.valueOf(100));
        ReceiverInfo receiver2 = new ReceiverInfo();
        receiver2.setReceiverCustomerNumber("CUST789");
        receiver2.setTransferQuantity(BigDecimal.valueOf(200));
        data.setReceiverLists(Arrays.asList(receiver1, receiver2));

        data.setRequestPriceValue(BigDecimal.valueOf(500)); // 500 * (100+200) = 150,000
        data.setSenderInvestmentAccountChecksumIdentifier("chk1");

        // Mock limit response
        RetrieveTransferLimitResponse limitResponse = new RetrieveTransferLimitResponse();
        RetrieveTransferLimitResponseData limitData = new RetrieveTransferLimitResponseData();
        limitData.setMaxDailyLimitedAmount(BigDecimal.valueOf(200000));
        limitData.setAvailableTodayAmount(BigDecimal.valueOf(180000));
        limitData.setMaxMonthlyLimitedAmount(BigDecimal.valueOf(500000));
        limitData.setAvailableMonthToDateAmount(BigDecimal.valueOf(450000));
        limitData.setMaxYearlyLimitedAmount(BigDecimal.valueOf(1000000));
        limitData.setAvailableYearToDateAmount(BigDecimal.valueOf(950000));
        limitResponse.setData(limitData);

        // Mock gold price
        GoldPriceResponse goldPriceResponse = new GoldPriceResponse();
        GoldPriceResponseData goldData = new GoldPriceResponseData();
        goldData.setGoldPriceAmount(BigDecimal.valueOf(505.50));
        goldData.setPublishTime("2025-11-20T10:00:00Z");
        goldPriceResponse.setData(goldData);

        // Mock party name
        PartyNameResponse partyNameResponse = new PartyNameResponse();
        PartyNameResponse.Name name = new PartyNameResponse.Name();
        name.setLastName("CHAN");
        name.setGivenName("ALICE");
        name.setCustomerChristianName("M");
        partyNameResponse.setName(name);

        // Mock SRE validation
        RuleResponse sreResponse = new RuleResponse();
        sreResponse.setValid(true);

        // Mock
        lenient().when(tradeLimitService.retrieveLimitations(any())).thenReturn(limitResponse);
        lenient().when(tradeTransferServiceImpl.retrieveAccountIdWithCheckSum(any())).thenReturn(new AccountId());
        lenient().when(tradeTransferServiceImpl.retrieveCustomerNamesWithCinNumber(eq("CUST123"), any())).thenReturn(partyNameResponse);
        lenient().when(tradeTransferServiceImpl.retrieveGoldPrice(any())).thenReturn(goldPriceResponse);
        lenient().when(sreValidationService.callSreForTransferValidation(any(), any(), any(), any())).thenReturn(sreResponse);
        lenient().when(sreValidationService.handleSreValidateResponse(any())).thenReturn(null);

        CreateTransferResponse mockResponse = new CreateTransferResponse();
        CreateTransferResponse.Data responseData = new CreateTransferResponse.Data();
        List<TransferOrderInfo> orderList = new ArrayList<>();
        TransferOrderInfo order = new TransferOrderInfo();
        orderList.add(order);
        responseData.setTransferOrderLists(orderList);
        mockResponse.setData(responseData);

        lenient().when(restClientService.post(anyString(), anyMap(), eq(request), eq(CreateTransferResponse.class), anyInt(), anyBoolean()))
                .thenReturn(mockResponse);

        // Act
        CreateTransferResponse result = tradeTransferServiceImpl.createTransfers(requestHeader, request);

        // Assert
        assertThat(result).isNotNull();
        assertThat(result.getData()).isNotNull();
        assertThat(result.getData().getRequestUniqueKey()).isEqualTo("unique-key-456");
        assertThat(result.getData().getTransferOrderLists().get(0).getRequestPriceValue()).isEqualTo(BigDecimal.valueOf(505.50));
        assertThat(result.getData().getTransferOrderLists().get(0).getRequestPriceAsOfDateTime()).isEqualTo("2025-11-20T10:00:00Z");

        // 验证 limit 校验被调用
        verify(tradeLimitService).retrieveLimitations(any());

        // 验证 SRE 被调用两次（两个 receiver）
        verify(sreValidationService, times(2)).callSreForTransferValidation(any(), any(), any(), any());

        // 验证金价被调用
        verify(tradeTransferServiceImpl).retrieveGoldPrice(any());

        // 验证名字设置
        assertThat(result.getData().getSenderCustomerName()).isEqualTo("CHAN ALICE M");
    }

    // ========================
    // 5. 测试 createTransfers 失败：日限额超限
    // ========================
    @Test
    void testCreateTransfers_DailyLimitExceeded_ThrowsException() {
        // Arrange
        CreateTransferRequest request = new CreateTransferRequest();
        CreateTransferRequest.Data data = new CreateTransferRequest.Data();
        data.setActionRequestCode("D");
        data.setReceiverLists(Collections.singletonList(new ReceiverInfo() {{
            setTransferQuantity(BigDecimal.valueOf(1000));
        }}));
        data.setRequestPriceValue(BigDecimal.valueOf(100)); // 100 * 1000 = 100,000

        RetrieveTransferLimitResponse limitResponse = new RetrieveTransferLimitResponse();
        RetrieveTransferLimitResponseData limitData = new RetrieveTransferLimitResponseData();
        limitData.setMaxDailyLimitedAmount(BigDecimal.valueOf(50000));
        limitData.setAvailableTodayAmount(BigDecimal.valueOf(40000)); // 超了
        limitResponse.setData(limitData);

        lenient().when(tradeLimitService.retrieveLimitations(any())).thenReturn(limitResponse);

        // Act & Assert
        TransferLimitExceededException exception = assertThrows(TransferLimitExceededException.class,
                () -> tradeTransferServiceImpl.createTransfers(requestHeader, request));

        assertThat(exception.getMessage()).contains("daily");
        assertThat(exception.getMessage()).contains("50000");
    }

    // ========================
    // 6. 测试 modifyTransfers 成功（A 操作）
    // ========================
    @Test
    void testModifyTransfers_Success_AOperation() {
        // Arrange
        UpdateTransferRequest request = new UpdateTransferRequest();
        UpdateTransferRequest.Data data = new UpdateTransferRequest.Data();
        data.setTransferActionCode("A"); // ACCEPT
        data.setReceiverInvestmentAccountChecksumIdentifier("chk1");
        data.setReceiverCustomerInternalNumber("CUST456");

        // Mock
        lenient().when(tradeTransferServiceImpl.retrieveAccountIdWithCheckSum(any())).thenReturn(new AccountId());
        lenient().when(tradeTransferServiceImpl.retrieveGoldPrice(any())).thenReturn(new GoldPriceResponse() {{
            setData(new GoldPriceResponseData() {{
                setGoldPriceAmount(BigDecimal.valueOf(505.50));
                setPublishTime("2025-11-20T10:00:00Z");
            }});
        }});

        RuleResponse sreResponse = new RuleResponse();
        sreResponse.setValid(true);
        lenient().when(sreValidationService.callSreForTransferValidation(any(), any(), any(), any())).thenReturn(sreResponse);
        lenient().when(sreValidationService.handleSreValidateResponse(any())).thenReturn(null);

        UpdateTransferResponse mockResponse = new UpdateTransferResponse();
        lenient().when(restClientService.put(anyString(), anyMap(), eq(request), eq(UpdateTransferResponse.class), anyInt(), anyBoolean()))
                .thenReturn(mockResponse);

        // Act
        UpdateTransferResponse result = tradeTransferServiceImpl.modifyTransfers(requestHeader, request);

        // Assert
        assertThat(result).isNotNull();
        assertThat(data.getReceiverInvestmentAccount()).isNotNull();
        assertThat(data.getReceivePriceValue()).isEqualTo(BigDecimal.valueOf(505.50));
        assertThat(data.getReceivePriceAsOfDateTime()).isEqualTo("2025-11-20T10:00:00Z");
        assertThat(data.getReceiverCustomerInternalNumber()).isEqualTo("CUST123"); // 被覆盖为当前用户
    }

    // ========================
    // 7. 测试 modifyTransfers 失败：非 A/R 操作，不校验 SRE
    // ========================
    @Test
    void testModifyTransfers_OtherOperation_NoSreValidation() {
        // Arrange
        UpdateTransferRequest request = new UpdateTransferRequest();
        UpdateTransferRequest.Data data = new UpdateTransferRequest.Data();
        data.setTransferActionCode("C"); // CANCEL

        lenient().when(restClientService.put(anyString(), anyMap(), eq(request), eq(UpdateTransferResponse.class), anyInt(), anyBoolean()))
                .thenReturn(new UpdateTransferResponse());

        // Act
        UpdateTransferResponse result = tradeTransferServiceImpl.modifyTransfers(requestHeader, request);

        // Assert
        assertThat(result).isNotNull();
        // 验证没有调用 SRE
        verify(sreValidationService, never()).callSreForTransferValidation(any(), any(), any(), any());
    }
}
